自动迁移（Auto Migration）
heading:: true
	- 随着开发需求的变化，数据库表结构可能会发生变化。为了保持数据库表结构与 Go 代码中的结构体模型同步，并避免手动修改数据库表，GORM 提供了 `AutoMigrate` 功能。该功能可以自动更新数据库表结构，包括创建新表、添加缺少的字段、外键约束和索引等，但不会删除现有的列数据，以确保数据的安全性。
	- **注意：**
		- **`AutoMigrate` 不会执行以下操作：**
			- **不会删除列**：如果你删除了结构体中的某个字段，数据库中的对应列不会被删除，从而避免数据丢失的风险。
			- **不会修改列的数据类型**：如果你修改了结构体中某个字段的数据类型（如将 `int` 改为 `string`），`AutoMigrate` 不会自动修改数据库中对应列的类型，避免数据丢失或格式不兼容的风险。此类操作需要手动处理。
			- **不会重命名表或列**：即使在结构体中更改了表名或列名，`AutoMigrate` 也不会自动修改数据库中的表或列。重命名操作需要手动执行相应的 SQL 语句。
	- **用法：**
		- ```go
		  db.AutoMigrate(&User{})
		  ```
		- 这个命令会检查 `User` 这个结构体模型对应的表是否存在，如果存在，就检查是否有需要更新的部分（例如新增列、修改列类型等）。
		- **迁移多个模型：**
			- 你可以一次迁移多个模型，GORM 会自动更新每个模型对应的表：
				- ```go
				  db.AutoMigrate(&User{}, &Product{}, &Order{})
				  ```
	- **迁移设置：**
		- **指定存储引擎：**
			- ```go
			  db.Set("gorm:table_options", "ENGINE=InnoDB").AutoMigrate(&User{})
			  ```
		- **指定字符集：**
			- 你可以为创建的表指定字符集，例如使用 `utf8mb4` 字符集来支持更多的 Unicode 字符，这比 `utf8` 字符集能支持更多的字符（如表情符号）。
			- ```go
			  db.Set("gorm:table_options", "CHARSET=utf8mb4").AutoMigrate(&User{})
			  ```
		- **指定排序规则：**
			- 排序规则（Collation）决定了字符串数据如何进行比较和排序。
			- ```go
			  db.Set("gorm:table_options", "COLLATE=utf8mb4_general_ci").AutoMigrate(&User{})
			  ```
- **该用 GORM 的迁移功能吗？**
	- 在项目开发初期，频繁修改数据库模型（如增加字段、修改表结构等）是常见需求。这时，可以大胆使用 `db.AutoMigrate(&Host{})`。通过 GORM 提供的自动迁移功能，`AutoMigrate` 能根据模型结构自动同步数据库表，每次修改模型后，在程序启动时运行它，不仅高效便捷，还能节省手动修改数据库表的时间，从而加速开发和迭代。
	- 随着项目的成熟并进入生产环境，数据库结构的变更需要更加规范和可控，因此必须切换到专业的数据库迁移工具。这些工具将每次结构变更写成带版本号的 SQL 文件，其中 `up.sql` 用于升级，`down.sql` 用于降级。与此相比，`AutoMigrate` 不再适用，因为它缺乏版本控制、回滚功能和对复杂操作的支持。使用迁移工具可以像管理代码一样对数据库变更进行版本控制，确保每个变更可追溯，增强变更过程的可控性和安全性。
-