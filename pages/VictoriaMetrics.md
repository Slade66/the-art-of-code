-
- VictoriaMetrics 是一个开源、高性能、可扩展的时序数据库和监控解决方案。它的架构设计旨在解决 Prometheus 在大规模、长期存储场景下的痛点。
-
- VictoriaMetrics 是 “Prometheus 生态兼容的增强版”
- **Prometheus**: 定义了云原生监控体系领域的**事实标准 (de facto standard)**。它不仅是一个工具，更是一整套监控哲学、数据模型和查询语言。整个云原生监控的生态系统都是围绕着它建立的。
- **VictoriaMetrics**: 它在设计上**完全兼容 Prometheus 的生态**，并致力于解决 Prometheus 在大规模场景下的一些痛点（性能、存储成本、集群扩展性等）。它是一个性能更强、更专注的“时间序列数据库 (TSDB)” 和存储方案。
-
- 它主要提供两种部署架构：**单节点（Single-Node）** 和 **集群（Cluster）**。
	- 单节点架构（Single-Node Architecture）:这是 VictoriaMetrics 最简单、最常见的部署方式。整个系统打包在一个独立的二进制文件 **`VictoriaMetrics`** 中。这个单一的二进制文件包含了所有功能,一体化（All-in-one），简单高效。
	- 集群架构（Cluster Architecture）:对于需要处理海量数据或需要高可用性的场景，VictoriaMetrics 提供了分布式集群架构。它将单节点的职责拆分成了三个独立的、可横向扩展的组件。
		- `vmagent`
			- 轻量级的数据采集器和转发器。它的主要目的就是为了在某些场景下取代 Prometheus，直接将数据从 Exporter 发送到 VictoriaMetrics。
			-
		- vminsert（数据写入）
			- `vminsert` **不是**一个数据采集器。它不会主动去 Exporter 暴露的端口（例如 `9100` 或 `8080`）那里采集数据。
			- `vminsert`  的核心职责是接收数据，vminsert 的角色是 被动地接收 数据。它监听一个端口，等待像 Prometheus 这样的采集器将数据 远程写入 进来。
			- 整个数据流程是这样的：
				- **数据采集**：你的 Prometheus 或其他数据采集器将监控数据发送给 `vminsert`。
				- **数据分发**：`vminsert` 接收数据并将其发送到集群中相应的 `vmstorage` 节点。
				- **数据存储**：`vmstorage` 节点将数据写入磁盘。
				- **数据查询**：当有查询请求时，`vmselect` 会向相应的 `vmstorage` 节点请求数据。
				  
				  总之，`vminsert` 扮演了一个高性能的**数据路由和分发层**的角色，它将大规模的写入流量均衡地分摊到整个集群中，是 VictoriaMetrics 集群架构可扩展性的关键。
			- 它的主要职责是接收来自各种源（如 Prometheus）的监控数据，并将这些数据智能地路由到集群中相应的存储节点。
			- **负载均衡和分发**：这是 `vminsert` 最关键的功能。它不会自己存储任何数据，而是根据一套规则（通常是基于时间序列 ID 的一致性哈希算法）来决定每个时间序列的数据应该被发送到哪一个 `vmstorage` 节点。
				- 这种分发方式确保了**同一时间序列（如某个主机的 CPU 使用率）的所有数据点都会被发送到同一个 `vmstorage` 节点**。这对于后面的查询至关重要，因为这样 `vmselect` 只需要向一个 `vmstorage` 节点请求完整的时间序列数据，而无需在多个节点上进行数据合并。
			- **水平扩展**：`vminsert` 本身是无状态的，这意味着你可以轻松地通过增加更多的 `vminsert` 实例来处理更高的写入流量，从而实现水平扩展。
			- **角色**：这是集群的入口点，负责接收来自 Prometheus 等源的远程写入数据。
			- **工作方式**：它会将接收到的数据流根据一定的规则（通常是哈希）**分发**到集群中的多个 `vmstorage` 节点上。它不负责存储数据，只负责数据的扇出（fan-out）
		- vmstorage（数据存储）
			- **角色**：集群中的核心组件，负责数据的实际存储。
			- **工作方式**：每个 `vmstorage` 节点只存储部分数据，它们共同构成一个大规模的、分布式存储系统。当 `vminsert` 发送数据过来时，`vmstorage` 负责将其写入磁盘。当 `vmselect` 发送查询请求时，它只返回自己存储的那部分数据。
		- vmselect（数据查询）
			- **角色**：集群的查询入口点，负责处理所有 PromQL 查询请求。
			- **工作方式**：当它收到一个查询请求时，它会将该请求**并行分发**到所有 `vmstorage` 节点。每个 `vmstorage` 节点独立执行查询，并将结果返回给 `vmselect`。最后，`vmselect` 将这些结果进行聚合，并返回最终的完整查询结果。
	- 分布式架构的优势：
		- 与 Prometheus 相比，VictoriaMetrics 的架构提供了以下显著优势：
			- **可扩展性（Scalability）**：集群架构允许你通过增加 `vminsert`、`vmstorage` 或 `vmselect` 节点来轻松实现水平扩展，以应对不断增长的数据量。
			- **长期存储（Long-Term Storage）**：它的存储引擎专为时序数据设计，提供了高压缩比，能高效地存储和查询海量的历史数据。
			- **查询性能（Query Performance）**：`vmselect` 的并行查询机制使得即使在海量数据上进行复杂查询，也能获得快速响应。
- [[vmagent]]
-